<html>
  <head>
    <title>Sentry - Login Success</title>

    <!-- TODO: this should be a sentry logo -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  </head>
  <body>
    <div>
      <p>You are logged in!</p>
      <p>If this window stays open, check the console for errors.</p>
    </div>

    <script>
      function notifyOpener() {
        if (!window.opener) {
          return;
        }
        const referrer = __REFERRER__;

        window.opener.postMessage('success', referrer);
        window.close();
      }
      // NOTE: In prod we should call this automatically, in test we will leave the page open for interaction.
      // notifyOpener();
    </script>

    <!-- NOTE: The following is for mock/test purposes and won't be in prod. -->
    <hr />

    <form id="accessTokenForm">
      <h3>sentry.io access token</h3>
      <p>
        This mock server is configured to proxy requests to sentry.io. Enter an Access Token to facilitate this.
      </p>
      <fieldset style="padding: 1em; display: flex; flex-direction: column; gap: 1em;">
        <label>
          Access Token:
          <input type="text" name="access_token" id="accessToken" />
          <div><a href="https://sentry.io/orgredirect/organizations/:orgslug/settings/account/api/auth-tokens/" target="_blank">Get an Auth Token</a></div>
        </label>

        <div>
          <button type="submit">Save Access Token</button>
        </div>
      </fieldset>
    </form>

    <button type="button" id="close-popup">Close Popup</button>
    <script>
    (function() {
      const accessTokenInput = document.getElementById('accessToken');
      accessTokenInput.value = localStorage.getItem('accessToken');

      document.getElementById('accessTokenForm').addEventListener('submit', (e) => {
        const token = accessTokenInput.value;
        localStorage.setItem('accessToken', token);
        e.preventDefault();
      });

      document.getElementById('close-popup').addEventListener('click', notifyOpener);
    })();
    </script>
  </body>
</html>
